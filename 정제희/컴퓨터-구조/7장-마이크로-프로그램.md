# 제7장 마이크로 프로그래밍

## [Part-1](https://www.youtube.com/watch?v=nhJ1prbfmuE&list=PLc8fQ-m7b1hCHTT7VH2oo0Ng7Et096dYc&index=16)

### 제어 메모리 (Control Memory)

1. 제어 메모리(control memory)

마이크로프로그램을 저장

2. 제어 주소 레지스터(Control Address Register)

제어 메모리로부터 읽어올 마이크로 명령어 주소를 지정

3. 시퀀서(sequencer=next address generator)

제어 메모리로부터 제어 명령어를 읽어올 주소 시퀀스를 생성

다음 마이크로 명령어의 주소는 입력에 따라 여러 가지 방법으로 결정할 수 있다.

4. 제어 데이터 레지스터(control data register)

제어 메모리에서 읽어 온 마이크로 명령어를 저장

매 클럭 펄스마다 데이터 레지스터의 제어 워드에서 지정하는 마이크로 연산과 다음 마이크로 명령을 읽어오는 동작을 동시에 수행

 => 시퀀서 수행 후 제어 주소 레지스터에 제어 메모리로부터 읽어올 마이크로 명령어 주소를 지정,  제어 메모리에서 끄집어와서 제어 데이터 레지스터에서 연산수행하고 다음 명령 읽어오는 동작 동시 수행



### 주소 시퀀싱 (Address Sequencing)

제어 메모리에 대한 일련의 접근 주소를 생성



#### 1) 제어메모리 주소 시퀀싱 단계

- 명령어 fetch
- 유효주소 계산
- **마이크로 연산 수행을 위한 제어워드 fetch**
- 명령어 실행



#### 2) 제어 메모리의 주소를 결정하는 방법

- **Branch** by condition
- **Mapping** from opcode
- **subroutine call/return**
- **Increment**



#### 3) Mapping

맵핑: OP code (Instruction Code)를 가지고 오면 이 명령어가 어디에 있는지 control memory에 결정. 

맵핑시 제어 메모리 접근 주소 결정 방법

1. 제어 주소 레지스터를 하나 증가

2. 무조건 분기와 상태 비트 조건에 따른 조건부 분기

3. 명령어 비트(op-code)들로부터 제어 메모리 주소 맵핑

4. 서브루틴을 호출하고 복귀



##### 조건부분기

분기 논리에 의해 선택적인 분기 동작을 하여 마이크로 프로그램 동작을 한다는 뜻 상태비트(U, I, S, Z)에 따른 분기



##### 명령어의 매핑

명령어 코드를 확인한 후 Microinstruction address인 7비트 코드로 변환 후 Control storage 인 CAR로 이동한다.

따라서 1011이라는 명령은 0101100 으로 맵핑이 되고 이것이 해당 명령어 루틴의 시작 주소가 된다. 그리고 이 루틴은 0101100, 0101101, 0101110, 0101111 이렇게 4가지까지 구성할 수 있고, 명령어의 갯수는 명령어 비트인 4비트 즉 16개의 명령어를 구성할 수 있다. 총 control memory 크기는 7비트이므로 2^7=128 이라고 할 수 있다. 



## [Part-2](https://www.youtube.com/watch?v=lBNXUYRcDHc&list=PLc8fQ-m7b1hCHTT7VH2oo0Ng7Et096dYc&index=17)

### 마이크로프로그램의 예 (Microprogram Example)

- 이진 마이크로 프로그램

- 마이크로 명령어 형식

  마이크로 명령어 형식은 20비트로 네 개의 필드로 나뉘어져 있다. F1, F2, F3로 표시되는 필드는 컴퓨터의 마이크로 연산을 지정하고 CD필드는 상태 비트 조건을 선택한다. BR 필드는 분기의 종류를 지정하고, AD필드는 분기 주소를 가지고 있다. 

- 기호로 표시된 마이크로 명령어

  - Fetch 루틴
  - Indirect 루틴



### 제어 장치의 설계 (Design of Control Unit)

- 마이크로 명령어는 각각 독립된 기능을 가지는 여러 개의 필드로 구성
  - 각 필드는 마이크로 연산을 구동시키기 위한 제어 비트를 포함
  - 다음 실행될 마이크로 명령어의 주소를 결정하는 방법을 지시
  - 분기를 위한 주소를 포함

- 동시에 수행되는 마이크로 연산들은 함께 모아서 인코딩하여 나타낼 수 있기 때문에 제어 비트의 수를 줄일 수 있음



- 마이크로 프로그램 시퀀서의 설계
  - input logic 설계
- 마이크로 연산 필드의 디코딩 회로

