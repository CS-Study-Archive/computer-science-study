## [프로세스 관리 #1](https://core.ewha.ac.kr/publicview/C0101020140321144554159683?vmode=f)

### 프로세스 생성 (Process Creation)

부모 프로세스가 자식 프로세스를 생성함 => **복제 생성**

code, stack, data, Context(PC) 등을 복제받음

- 프로세스의 트리(계층 구조) 형성
- 프로세스는 자원을 필요로 함
  - 운영체제로부터 받는다
    -  부모와 공유한다
- 자원의 공유 모델
  - 부모와 자식이 모든 자원을 공유하는 모델
  - 일부만 공유하는 모델
  - 전혀 공유하지 않는 모델 => 원칙적으로 부모 프로세스에서 자식 프로세스를 복제하게 되면 전혀 다른 프로세스이기 때문에 공유하지 않는 것이 원칙
- 수행 모델
  - 부모와 자식이 공존하며 수행되는 모델
  - 자식이 종료될 때까지 부모가 기다리는 모델
- Copy-On-Write
  - Write가 발생하기 전까지는 부모와 모든 것을 공유하고 있다가, write가 발생하면 그 때부터 독자적인 프로세스가 되어서 나눠짐


#### 생성 절차

1단계: 부모의 주소 공간을 복사하여 자식 프로세스가 탄생(복제 생성)

2단계: 자식은 그 공간에 새로운 프로그램을 올리며, 전혀 다른 프로세스가 됨

단, 모든 단계를 반드시 다 거쳐야하는 것은 아님 => 2단계 없이 복제만 할 수도 있음

<br>

### 프로세스 종료 (Process Termination)

#### exit

자발적

프로세스가 마지막 명령을 수행한 후 운영체제에게 이를 알려줌

자식이 부모에게 output 데이터를 보내고, 프로세스의 각종 자원들이 운영체제에게 반납됨

#### abort

강제적

부모 프로세스가 자식 프로세스의 수행을 종료시킴

자식의 할당 자원 한계치를 넘어서거나 자식에게 할당된 태스크가 더 이상 필요하지 않을 경우

또는 부모가 종료되는 경우 운영체제는 부모가 종료되었는데 자식이 더 이상 수행되는 것을 내버려두지 않음

<br>

## [프로세스 관리 #2](https://core.ewha.ac.kr/publicview/C0101020140325134428879622?vmode=f)

### 프로세스와 관련한 시스템콜

#### fork()

```C
int main(){ 
    int pid;
 	pid = fork();
    if (pid == 0) printf("Hello, I'm Child")
    else if (pid > 0) printf("Hello, I'm Parent")
    }
```

fork를 해서 자식을 생성하더라도, 자식이 다시 처음부터 프로그램을 실행하여 fork를 실행하는 것이 아니라 부모의 context도 같이 복제되기 때문에 main함수가 아니라, fork 이후 부분부터 실행하기 시작함

fork함수의 return 값을 통해 부모 프로세스인지, 자식 프로세스인지를 구분할 수 있음

#### exec()

```C
int main() {
    printf("1")
    execlp("...") // 완전히 새로운 프로그램으로 덮어씌워지기 때문에 main의 첫부분으로 돌아감
    printf("2") // 절대 실행되지 않음
}
```

아예 완전히 새로운 프로그램으로 덮어 씌움 => 따라서 main 함수의 처음부터 실행하게 됨

#### wait()

부모 프로세스가 wait() 시스템 콜을 하면 커널은 자식 프로세스가 종료될 때까지 부모 프로세스를 sleep(block)시킨다. 자식이 종료되면, 커널이 부모 프로세스를 깨움(ready)

보통 부모 프로세스가 자식 프로세스를 생성한 뒤에 wait() 시스템 콜을 함

#### exit()

프로세스가 종료될 때 호출하는 시스템 콜

가지고 있던 모든 자원을 OS에 반납하고 종료됨

- 자발적 종료 => 코드의 마지막 문장 또는 중간에 exit()을 통해 프로세스를 자발적으로 종료함
- 강제적 종료
  - 부모 프로세스가 자식 프로세스를 강제 종료 시킴
  - 외부에서 kill, break 등을 통해 비자발적으로 프로세스를 종료시킴
  - 부모 프로세스 본인이 종료되는 경우 => 자식이 먼저 종료되고 나서 부모가 순차적으로 종료됨

### 프로세스 간 협력

원칙적으로 프로세스는 서로 독립적임

- 프로세스는 각자의 주소 공간을 가지고 수행되므로 하나의 프로세스가 다른 프로세스의 수행에 영향을 미치지 못함

### 프로세스 간 협력 메커니즘(IPC); Interprocess communication

**I**nter**P**rocess **C**ommunication

#### Message Passing

- 다른 프로세스에게 메세지를 전달 => **커널을 통해서 전달(message passing)**
  - 직접 통신: 통신하려는 프로세스의 이름을 명시적으로 표시
  - 간접 통신: mailbox나 port를 통해서 간접 전달

#### Shared Memory

- 주소 공간을 공유 => **shared memory**
  - 서로 다른 프로세스가 물리적인 메모리 공간을 공유함
- 스레드는 하나의 프로세스 내에 (여러 개) 존재하는 것이므로, 프로세스 간 협력으로 볼 수는 없지만, 프로세스를 구성하는 스레드 간에는 주소 공간을 공유하므로 협력이 가능함

